# API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - Telegram Bot

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç API –∏ —Ñ—É–Ω–∫—Ü–∏–∏ Telegram-–±–æ—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∫–µ—Ç–∞–º–∏.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
```python
bot = telebot.TeleBot("YOUR_BOT_TOKEN")
```

#### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
```python
MAIN_ADMIN_TELEGRAM_ID = '6664891663'
MAIN_ADMIN_PASSWORD = 'r–Æ!a9*–∫‚Ññ—ÉD:b'
JUNIOR_ADMIN_TELEGRAM_ID = '8068244167'
JUNIOR_ADMIN_PASSWORD = '!pW&ix^;1^|Q'
```

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
```python
def get_db_connection():
    db_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'MegaBASE2.db')
    conn = sqlite3.connect(db_path, check_same_thread=False)
    return conn
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

**–¢–∞–±–ª–∏—Ü–∞ `users`:**
- `id` (INTEGER PRIMARY KEY)
- `telegram_id` (TEXT UNIQUE)
- `phone` (TEXT)
- `role` (TEXT)
- `status` (TEXT)
- `password` (TEXT)
- `search_count` (INTEGER DEFAULT 0)
- `date_added` (TEXT)

**–¢–∞–±–ª–∏—Ü–∞ `profiles`:**
- `id` (INTEGER PRIMARY KEY)
- `user_id` (INTEGER, FOREIGN KEY)
- `user_info` (TEXT)
- `type` (TEXT)
- `characteristic` (TEXT)
- `comment` (TEXT)
- `date_added` (TEXT)

**–¢–∞–±–ª–∏—Ü–∞ `search_history`:**
- `id` (INTEGER PRIMARY KEY)
- `user_id` (INTEGER, FOREIGN KEY)
- `search_text` (TEXT)
- `date_searched` (TEXT)

**–¢–∞–±–ª–∏—Ü–∞ `requests`:**
- `request_id` (INTEGER PRIMARY KEY)
- `user_id` (INTEGER UNIQUE)
- `username` (TEXT)
- `is_approved` (INTEGER DEFAULT 0)
- `role` (TEXT DEFAULT 'user')
- `created_at` (DATETIME DEFAULT CURRENT_TIMESTAMP)

### 3. –°–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Å—Å–∏–∏
```python
session_data = {
    "characteristics": set(),      # –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∞–Ω–∫–µ—Ç—ã
    "profile_type": None,         # –¢–∏–ø –∞–Ω–∫–µ—Ç—ã
    "user_info": {                # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        "phone": None,            # –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        "telegram_id": None       # Telegram ID
    },
    "comment": None               # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∞–Ω–∫–µ—Ç–µ
}
```

#### –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π
```python
def initialize_session(chat_id):
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ chat_id"""

def clear_session(chat_id):
    """–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏"""
```

### 4. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```python
@bot.message_handler(commands=['start'])
def start(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""

def verify_password(message):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
```

#### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```python
def main_menu(message):
    """–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π"""
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç
```python
def add_information(message):
    """–ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∫–µ—Ç—ã"""

def process_user_info(message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""

def process_profile_type_selection(call):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∞–Ω–∫–µ—Ç—ã"""

def process_characteristic_selection(call):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫"""

def save_profile(chat_id, user_info, profile_type, characteristics, comment):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
```

#### –ü–æ–∏—Å–∫
```python
def search_request(message):
    """–ó–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞"""

def perform_search(message):
    """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""

def display_search_results(message, page, edit_message=True):
    """–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π"""
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏
```python
@bot.callback_query_handler(func=lambda call: call.data == "–ø—Ä–æ—Å–º–æ—Ç—Ä_–∑–∞—è–≤–æ–∫")
def show_requests_callback(call):
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é"""

def process_request(call):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ (–æ–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ)"""
```

### 5. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

#### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
```python
def normalize_phone(phone):
    """–ü—Ä–∏–≤–æ–¥–∏—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫ —Ñ–æ—Ä–º–∞—Ç—É +7XXXXXXXXXX"""
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
```python
def validate_input(input_text):
    """–í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –≤–≤–æ–¥ Telegram ID –∏ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞"""
```

### 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
```python
def hash_password(password):
    """–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SHA-256"""
    return hashlib.sha256(password.encode()).hexdigest()
```

### 7. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π

#### Callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
```python
@bot.callback_query_handler(func=lambda call: call.data in ["–ø–æ–∏—Å–∫", "–î–æ–±–∞–≤–∏—Ç—å", "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "–í—ã—Ö–æ–¥"])
def handle_main_menu_buttons(call):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é"""

@bot.callback_query_handler(func=lambda call: call.data.startswith("type_"))
def process_profile_type_selection(call):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∞–Ω–∫–µ—Ç—ã"""

@bot.callback_query_handler(func=lambda call: call.data.startswith("character_"))
def process_characteristic_selection(call):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫"""

@bot.callback_query_handler(func=lambda call: call.data.startswith("page_"))
def handle_page_navigation(call):
    """–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
```

### 8. –¢–∏–ø—ã –∞–Ω–∫–µ—Ç –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

#### –¢–∏–ø—ã –∞–Ω–∫–µ—Ç
- `–ü–æ–¥—Ö–æ–¥—è—â–∏–πüü©`: –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- `–ü—Ä–æ–±–ª–µ–º–Ω—ã–πüü•`: –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- `–ù–µ –±—ã–ª‚¨õÔ∏è`: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- `–í–∏—Ä—Çüü¶`: –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

#### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∞–Ω–∫–µ—Ç
- `–í–µ–∂–ª–∏–≤—ã–πüòä`
- `–ß–∏—Å—Ç–æ–ø–ª–æ—Ç–Ω—ã–πüíß`
- `–ö—Ä–∞—Å–∏–≤—ã–π‚ú®`
- `–ë–æ–ª—å—à–æ–π>15`
- `–ú–∞–ª–µ–Ω—å–∫–∏–π<15`
- `–¢–æ–ª—Å—Ç—ã–πüçî`
- `–•—É–¥–æ–πüßç‚Äç‚ôÇÔ∏è`
- `–ò–∑–≤–µ—Å—Ç–Ω—ã–πüî•`

#### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∞–Ω–∫–µ—Ç
- `–•–∞–ºüò†`
- `–ù–∏—â–∏–πüí∞`
- `–î—Ä–æ—áü§¶`
- `–ù–∞—Ä–∫–æ–º–∞–Ωüíâ`
- `–í—ã–º–æ–≥–∞—Ç–µ–ª—åüíÄ`
- `–ú–µ–Ω—ÇüëÆ`

### 9. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫
- `sqlite3.Error`: –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `ValueError`: –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `ConnectionError`: –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `telebot.apihelper.ApiException`: –û—à–∏–±–∫–∏ Telegram API

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
print(f"–û—à–∏–±–∫–∞: {e}")  # –ë–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
```

### 10. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
```python
PAGE_SIZE = 3  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–Ω–∫–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (SHA-256)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∞–Ω–∫–µ—Ç—ã
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `/start`
2. –í—ã–±–∏—Ä–∞–µ—Ç "–î–æ–±–∞–≤–∏—Ç—å" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
3. –í–≤–æ–¥–∏—Ç Telegram ID –∏/–∏–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
4. –í—ã–±–∏—Ä–∞–µ—Ç —Ç–∏–ø –∞–Ω–∫–µ—Ç—ã
5. –í—ã–±–∏—Ä–∞–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
6. –í–≤–æ–¥–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
7. –ê–Ω–∫–µ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–∏—Å–∫ –∞–Ω–∫–µ—Ç
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç "–ü–æ–∏—Å–∫" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í–≤–æ–¥–∏—Ç Telegram ID –∏–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
3. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
4. –ú–æ–∂–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç "–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫"
2. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
3. –û–¥–æ–±—Ä—è–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞—è–≤–∫–∏
4. –ù–∞–∑–Ω–∞—á–∞–µ—Ç —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
